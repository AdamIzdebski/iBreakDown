<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iBreakDown plots for classification models â€¢ iBreakDown</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://DrWhy.AI/">
        <img src="https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_iBreakDown_classification.html">iBreakDown plots for classification models</a>
    </li>
    <li>
      <a href="../articles/vignette_iBreakDown_regression.html">iBreakDown plots for regression models</a>
    </li>
    <li>
      <a href="../articles/vignette_iBreakDown_titanic.html">iBreakDown plots for Sinking of the RMS Titanic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="vignette_iBreakDown_classification_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="vignette_iBreakDown_classification_files/r2d3-render-0.1.0/r2d3-render.js"></script><script src="vignette_iBreakDown_classification_files/webcomponents-2.0.0/webcomponents.js"></script><script src="vignette_iBreakDown_classification_files/r2d3-binding-0.2.3/r2d3.js"></script><script src="vignette_iBreakDown_classification_files/d3v4-4.13.0/d3.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>iBreakDown plots for classification models</h1>
                        <h4 class="author">Dariusz Komosinski</h4>
            
            <h4 class="date">2019-07-25</h4>
      
      
      <div class="hidden name"><code>vignette_iBreakDown_classification.Rmd</code></div>

    </div>

    
    
<p>Here we will use the <code>HR</code> data from <a href="https://github.com/pbiecek/DALEX"><code>DALEX</code></a> package to present the <code>iBreakDown</code> for classification models.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># devtools::install_github("ModelOriented/DALEX")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEX"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"iBreakDown"</span>)

<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(HR)</code></pre></div>
<pre><code>#&gt;   gender      age    hours evaluation salary   status
#&gt; 1   male 32.58267 41.88626          3      1    fired
#&gt; 2 female 41.21104 36.34339          2      5    fired
#&gt; 3   male 37.70516 36.81718          3      0    fired
#&gt; 4 female 30.06051 38.96032          3      2    fired
#&gt; 5   male 21.10283 62.15464          5      3 promoted
#&gt; 6   male 40.11812 69.53973          2      0    fired</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_observation &lt;-<span class="st"> </span>HR_test[<span class="dv">1</span>,]
new_observation</code></pre></div>
<pre><code>#&gt;   gender      age    hours evaluation salary status
#&gt; 1   male 57.72683 42.31527          2      2  fired</code></pre>
<div id="glm" class="section level2">
<h2 class="hasAnchor">
<a href="#glm" class="anchor"></a>glm</h2>
<p>First, we fit a model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"nnet"</span>)
m_glm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span>(status <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> HR, <span class="dt">probabilities =</span> <span class="ot">TRUE</span>, <span class="dt">model =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>#&gt; # weights:  21 (12 variable)
#&gt; initial  value 8620.810629 
#&gt; iter  10 value 7002.127738
#&gt; iter  20 value 6239.478146
#&gt; iter  20 value 6239.478126
#&gt; iter  20 value 6239.478124
#&gt; final  value 6239.478124 
#&gt; converged</code></pre>
<p>To understand the factors that drive predictions for a single observation we use the <code>iBreakDown</code> package.</p>
<p>However, sometimes we need to create custom predict function which returns probalilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_fun &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata) {
   <span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(newdata) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
      <span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object, newdata, <span class="dt">type =</span> <span class="st">"prob"</span>)))
   } <span class="cf">else</span> {
     <span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object, <span class="dt">newdata=</span>newdata, <span class="dt">type =</span> <span class="st">"prob"</span>))
   }
 }</code></pre></div>
<p>Now we create an object of the <code>break_down</code> class. If we want to plot distributions of partial predictions, set <code>keep_distributions = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bd_glm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/local_attributions.html">local_attributions</a></span>(m_glm,
                            <span class="dt">data =</span> HR_test,
                            <span class="dt">new_observation =</span>  new_observation,
                            <span class="dt">keep_distributions =</span> <span class="ot">TRUE</span>,
                            <span class="dt">predict_function =</span> p_fun)</code></pre></div>
<p>We can simply print the result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bd_glm</code></pre></div>
<pre><code>#&gt;                                   contribution
#&gt; multinom.fired: intercept                0.361
#&gt; multinom.fired: evaluation = 2           0.084
#&gt; multinom.fired: hours = 42               0.129
#&gt; multinom.fired: gender = male           -0.007
#&gt; multinom.fired: age = 58                -0.005
#&gt; multinom.fired: salary = 2               0.002
#&gt; multinom.fired: status = fired           0.000
#&gt; multinom.fired: prediction               0.563
#&gt; multinom.ok: intercept                   0.281
#&gt; multinom.ok: evaluation = 2              0.134
#&gt; multinom.ok: hours = 42                 -0.016
#&gt; multinom.ok: gender = male               0.006
#&gt; multinom.ok: age = 58                    0.004
#&gt; multinom.ok: salary = 2                 -0.002
#&gt; multinom.ok: status = fired              0.000
#&gt; multinom.ok: prediction                  0.407
#&gt; multinom.promoted: intercept             0.358
#&gt; multinom.promoted: evaluation = 2       -0.218
#&gt; multinom.promoted: hours = 42           -0.113
#&gt; multinom.promoted: gender = male         0.001
#&gt; multinom.promoted: age = 58              0.002
#&gt; multinom.promoted: salary = 2            0.000
#&gt; multinom.promoted: status = fired        0.000
#&gt; multinom.promoted: prediction            0.030</code></pre>
<p>Or plot it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_glm)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Use the <code>baseline</code> argument to set the origin of plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_glm, <span class="dt">baseline =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<p>Use the <code>plot_distributions</code> argument to see distributions of partial predictions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_glm, <span class="dt">plot_distributions =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>For another types of models we proceed analogously.</p>
</div>
<div id="randomforest" class="section level2">
<h2 class="hasAnchor">
<a href="#randomforest" class="anchor"></a>randomForest</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(randomForest)

m_rf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(status <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> HR)

p_fun &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata){<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object, <span class="dt">newdata =</span> newdata, <span class="dt">type =</span> <span class="st">"prob"</span>)}

bd_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/local_attributions.html">local_attributions</a></span>(m_rf,
                            <span class="dt">data =</span> HR_test,
                            <span class="dt">new_observation =</span>  new_observation,
                            <span class="dt">predict_function =</span> p_fun)

bd_rf</code></pre></div>
<pre><code>#&gt;                                               contribution
#&gt; randomForest.formula.fired: intercept                0.379
#&gt; randomForest.formula.fired: hours = 42               0.231
#&gt; randomForest.formula.fired: evaluation = 2           0.063
#&gt; randomForest.formula.fired: salary = 2              -0.254
#&gt; randomForest.formula.fired: gender = male            0.029
#&gt; randomForest.formula.fired: age = 58                 0.323
#&gt; randomForest.formula.fired: status = fired           0.000
#&gt; randomForest.formula.fired: prediction               0.770
#&gt; randomForest.formula.ok: intercept                   0.268
#&gt; randomForest.formula.ok: hours = 42                 -0.043
#&gt; randomForest.formula.ok: evaluation = 2              0.096
#&gt; randomForest.formula.ok: salary = 2                  0.251
#&gt; randomForest.formula.ok: gender = male              -0.032
#&gt; randomForest.formula.ok: age = 58                   -0.311
#&gt; randomForest.formula.ok: status = fired              0.000
#&gt; randomForest.formula.ok: prediction                  0.230
#&gt; randomForest.formula.promoted: intercept             0.353
#&gt; randomForest.formula.promoted: hours = 42           -0.188
#&gt; randomForest.formula.promoted: evaluation = 2       -0.159
#&gt; randomForest.formula.promoted: salary = 2            0.003
#&gt; randomForest.formula.promoted: gender = male         0.003
#&gt; randomForest.formula.promoted: age = 58             -0.012
#&gt; randomForest.formula.promoted: status = fired        0.000
#&gt; randomForest.formula.promoted: prediction            0.000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_rf)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotD3.html">plotD3</a></span>(bd_rf)</code></pre></div>
<div id="htmlwidget-74faf3ecf6146cd640df" style="width:576px;height:576px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-74faf3ecf6146cd640df">{"x":{"data":[{"randomForest.formula.fired":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.379,"sign":"X","position":8,"label":"randomForest.formula.fired","barStart":0.3787,"barSupport":0.3787,"tooltipText":"Average response: 0.379<br>Prediction: 0.77"},{"variable":"hours = 42","contribution":0.231,"variable_name":"hours","variable_value":"42","cummulative":0.609,"sign":"1","position":7,"label":"randomForest.formula.fired","barStart":0.3787,"barSupport":0.6095,"tooltipText":"hours = 42<br>increases average response <br>by 0.231"},{"variable":"evaluation = 2","contribution":0.063,"variable_name":"evaluation","variable_value":"2","cummulative":0.672,"sign":"1","position":6,"label":"randomForest.formula.fired","barStart":0.6095,"barSupport":0.6721,"tooltipText":"evaluation = 2<br>increases average response <br>by 0.063"},{"variable":"salary = 2","contribution":-0.254,"variable_name":"salary","variable_value":"2","cummulative":0.418,"sign":"-1","position":5,"label":"randomForest.formula.fired","barStart":0.4185,"barSupport":0.6721,"tooltipText":"salary = 2<br>decreases average response <br>by 0.254"},{"variable":"gender = male","contribution":0.029,"variable_name":"gender","variable_value":"male","cummulative":0.447,"sign":"1","position":4,"label":"randomForest.formula.fired","barStart":0.4185,"barSupport":0.4474,"tooltipText":"gender = male<br>increases average response <br>by 0.029"},{"variable":"age = 58","contribution":0.323,"variable_name":"age","variable_value":"58","cummulative":0.77,"sign":"1","position":3,"label":"randomForest.formula.fired","barStart":0.4474,"barSupport":0.77,"tooltipText":"age = 58<br>increases average response <br>by 0.323"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0.77,"sign":"0","position":2,"label":"randomForest.formula.fired","barStart":0.77,"barSupport":0.77,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":0.391,"variable_name":"prediction","variable_value":"","cummulative":0.77,"sign":"X","position":1,"label":"randomForest.formula.fired","barStart":0.3787,"barSupport":0.77,"tooltipText":"Average response: 0.379<br>Prediction: 0.77"}],"randomForest.formula.ok":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.268,"sign":"X","position":8,"label":"randomForest.formula.ok","barStart":0.2682,"barSupport":0.2682,"tooltipText":"Average response: 0.268<br>Prediction: 0.23"},{"variable":"hours = 42","contribution":-0.043,"variable_name":"hours","variable_value":"42","cummulative":0.226,"sign":"-1","position":7,"label":"randomForest.formula.ok","barStart":0.2257,"barSupport":0.2682,"tooltipText":"hours = 42<br>decreases average response <br>by 0.043"},{"variable":"evaluation = 2","contribution":0.096,"variable_name":"evaluation","variable_value":"2","cummulative":0.322,"sign":"1","position":6,"label":"randomForest.formula.ok","barStart":0.2257,"barSupport":0.3221,"tooltipText":"evaluation = 2<br>increases average response <br>by 0.096"},{"variable":"salary = 2","contribution":0.251,"variable_name":"salary","variable_value":"2","cummulative":0.573,"sign":"1","position":5,"label":"randomForest.formula.ok","barStart":0.3221,"barSupport":0.5729,"tooltipText":"salary = 2<br>increases average response <br>by 0.251"},{"variable":"gender = male","contribution":-0.032,"variable_name":"gender","variable_value":"male","cummulative":0.541,"sign":"-1","position":4,"label":"randomForest.formula.ok","barStart":0.5411,"barSupport":0.5729,"tooltipText":"gender = male<br>decreases average response <br>by 0.032"},{"variable":"age = 58","contribution":-0.311,"variable_name":"age","variable_value":"58","cummulative":0.23,"sign":"-1","position":3,"label":"randomForest.formula.ok","barStart":0.23,"barSupport":0.5411,"tooltipText":"age = 58<br>decreases average response <br>by 0.311"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0.23,"sign":"0","position":2,"label":"randomForest.formula.ok","barStart":0.23,"barSupport":0.23,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":-0.038,"variable_name":"prediction","variable_value":"","cummulative":0.23,"sign":"X","position":1,"label":"randomForest.formula.ok","barStart":0.23,"barSupport":0.2682,"tooltipText":"Average response: 0.268<br>Prediction: 0.23"}],"randomForest.formula.promoted":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.353,"sign":"X","position":8,"label":"randomForest.formula.promoted","barStart":0.3531,"barSupport":0.3531,"tooltipText":"Average response: 0.353<br>Prediction: 0"},{"variable":"hours = 42","contribution":-0.188,"variable_name":"hours","variable_value":"42","cummulative":0.165,"sign":"-1","position":7,"label":"randomForest.formula.promoted","barStart":0.1649,"barSupport":0.3531,"tooltipText":"hours = 42<br>decreases average response <br>by 0.188"},{"variable":"evaluation = 2","contribution":-0.159,"variable_name":"evaluation","variable_value":"2","cummulative":0.006,"sign":"-1","position":6,"label":"randomForest.formula.promoted","barStart":0.0059,"barSupport":0.1649,"tooltipText":"evaluation = 2<br>decreases average response <br>by 0.159"},{"variable":"salary = 2","contribution":0.003,"variable_name":"salary","variable_value":"2","cummulative":0.009,"sign":"1","position":5,"label":"randomForest.formula.promoted","barStart":0.0059,"barSupport":0.0087,"tooltipText":"salary = 2<br>increases average response <br>by 0.003"},{"variable":"gender = male","contribution":0.003,"variable_name":"gender","variable_value":"male","cummulative":0.012,"sign":"1","position":4,"label":"randomForest.formula.promoted","barStart":0.0087,"barSupport":0.0115,"tooltipText":"gender = male<br>increases average response <br>by 0.003"},{"variable":"age = 58","contribution":-0.012,"variable_name":"age","variable_value":"58","cummulative":0,"sign":"-1","position":3,"label":"randomForest.formula.promoted","barStart":0,"barSupport":0.0115,"tooltipText":"age = 58<br>decreases average response <br>by 0.012"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0,"sign":"0","position":2,"label":"randomForest.formula.promoted","barStart":0,"barSupport":0,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":-0.353,"variable_name":"prediction","variable_value":"","cummulative":0,"sign":"X","position":1,"label":"randomForest.formula.promoted","barStart":0,"barSupport":0.3531,"tooltipText":"Average response: 0.353<br>Prediction: 0"}]},["intercept","hours = 42","evaluation = 2","salary = 2","gender = male","age = 58","status = fired","prediction","intercept","hours = 42","evaluation = 2","salary = 2","gender = male","age = 58","status = fired","prediction","intercept","hours = 42","evaluation = 2","salary = 2","gender = male","age = 58","status = fired","prediction"]],"type":"json","container":"svg","options":{"xmin":-0.154,"xmax":0.924,"n":3,"m":8,"barWidth":12,"scaleHeight":false,"time":0,"vcolors":"default","chartTitle":"Local attributions"},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/colorsDrWhy.js */\nfunction getColors(n, type){\n    var temp = [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n    var ret = [];\n\n    if (type == \"bar\") {\n      switch(n){\n        case 1:\n          return [\"#46bac2\"];\n        case 2:\n          return [\"#46bac2\", \"#4378bf\"];\n        case 3:\n          return [\"#8bdcbe\", \"#4378bf\", \"#46bac2\"];\n        case 4:\n          return [\"#46bac2\", \"#371ea3\", \"#8bdcbe\", \"#4378bf\"];\n        case 5:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ffa58c\"];\n        case 6:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\"];\n        case 7:\n          return temp;\n        default:\n          for (var i = 0; i <= n%7; i++) {\n            ret = ret.concat(temp);\n          }\n          return ret;\n      }\n    } else if (type == \"line\") {\n      switch(n){\n        case 1:\n          return [\"#46bac2\"];\n        case 2:\n          return [\"#8bdcbe\", \"#4378bf\"];\n        case 3:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\"];\n        case 4:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ffa58c\"];\n        case 5:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ae2c87\", \"#ffa58c\"];\n        case 6:\n          return [\"#8bdcbe\", \"#f05a71\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n        case 7:\n          return temp;\n        default:\n          for (var j = 0; j <= n%7; j++) {\n            ret = ret.concat(temp);\n          }\n          return ret;\n      }\n    } else if (type == \"point\") {\n      switch(n){\n        default:\n          return [\"#371ea3\", \"#46bac2\", \"#ceced9\"];\n      }\n    } else if (type == \"breakDown\") {\n      switch(n){\n        default:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\"];\n      }\n    }\n}\n\nfunction calculateTextWidth(text) {\n  // calculate max width of 11px text array\n\n  var temp = svg.selectAll()\n                .data(text)\n                .enter();\n\n  var textWidth = [];\n\n  temp.append(\"text\")\n      .attr(\"class\", \"toRemove\")\n      .text(function(d) { return d;})\n      .style(\"font-size\", \"11px\")\n      .style('font-family', 'Fira Sans, sans-serif')\n      .each(function(d,i) {\n          var thisWidth = this.getComputedTextLength();\n          textWidth.push(thisWidth);\n      });\n\n  svg.selectAll('.toRemove').remove();\n  temp.remove();\n\n  var maxLength = d3.max(textWidth);\n\n  return maxLength;\n}\n\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/tooltipD3.js */\n// TOOLTIP\n\n// d3.tip\n// Copyright (c) 2013 Justin Palmer\n// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete\n// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz\n//\n// Tooltips for d3.js SVG visualizations\n\nd3.functor = function functor(v) {\n  return typeof v === \"function\" ? v : function() {\n    return v;\n  };\n};\n\nd3.tip = function() {\n\n  var direction = d3_tip_direction,\n      offset    = d3_tip_offset,\n      html      = d3_tip_html,\n      node      = initNode(),\n      svg       = null,\n      point     = null,\n      target    = null\n\n  function tip(vis) {\n    svg = getSVGNode(vis)\n    point = svg.createSVGPoint()\n    document.body.appendChild(node)\n  }\n\n  // Public - show the tooltip on the screen\n  //\n  // Returns a tip\n  tip.show = function() {\n    var args = Array.prototype.slice.call(arguments)\n    if(args[args.length - 1] instanceof SVGElement) target = args.pop()\n\n    var content = html.apply(this, args),\n        poffset = offset.apply(this, args),\n        dir     = direction.apply(this, args),\n        nodel   = getNodeEl(),\n        i       = directions.length,\n        coords,\n        scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,\n        scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft\n\n    nodel.html(content)\n      .style('position', 'absolute')\n      .style('opacity', 1)\n      .style('pointer-events', 'all')\n\n    while(i--) nodel.classed(directions[i], false)\n    coords = direction_callbacks[dir].apply(this)\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n\n    var divDim = node.getBoundingClientRect(),\n        svgDim = svg.getBBox();\n\n    if (d3.event.pageY + divDim.height > svgDim.height) {\n      nodel.classed(dir, true).style('top', (d3.event.pageY - divDim.height - 10) + scrollTop  + 'px');\n    } else {\n      nodel.classed(dir, true).style('top', (d3.event.pageY + 10) + scrollTop  + 'px');\n    }\n\n    if (d3.event.pageX + divDim.width/2 > svgDim.width) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width - 10) + scrollLeft + 'px');\n    } else if (d3.event.pageX - divDim.width/2 < 5) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX + divDim.width + 10) + scrollLeft + 'px');\n    } else {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width/2) + scrollLeft + 'px');\n    }\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n    return tip\n  }\n\n  // Public - hide the tooltip\n  //\n  // Returns a tip\n  tip.hide = function() {\n    var nodel = getNodeEl()\n    nodel\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n    return tip\n  }\n\n  // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.\n  //\n  // n - name of the attribute\n  // v - value of the attribute\n  //\n  // Returns tip or attribute value\n  tip.attr = function(n, v) {\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().attr(n)\n    } else {\n      var args =  Array.prototype.slice.call(arguments)\n      d3.selection.prototype.attr.apply(getNodeEl(), args)\n    }\n\n    return tip\n  }\n\n  // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.\n  //\n  // n - name of the property\n  // v - value of the property\n  //\n  // Returns tip or style property value\n  tip.style = function(n, v) {\n    // debugger;\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().style(n)\n    } else {\n      var args = Array.prototype.slice.call(arguments);\n      if (args.length === 1) {\n        var styles = args[0];\n        Object.keys(styles).forEach(function(key) {\n          return d3.selection.prototype.style.apply(getNodeEl(), [key, styles[key]]);\n        });\n      }\n    }\n\n    return tip\n  }\n\n  // Public: Set or get the direction of the tooltip\n  //\n  // v - One of n(north), s(south), e(east), or w(west), nw(northwest),\n  //     sw(southwest), ne(northeast) or se(southeast)\n  //\n  // Returns tip or direction\n  tip.direction = function(v) {\n    if (!arguments.length) return direction\n    direction = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: Sets or gets the offset of the tip\n  //\n  // v - Array of [x, y] offset\n  //\n  // Returns offset or\n  tip.offset = function(v) {\n    if (!arguments.length) return offset\n    offset = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: sets or gets the html value of the tooltip\n  //\n  // v - String value of the tip\n  //\n  // Returns html value or tip\n  tip.html = function(v) {\n    if (!arguments.length) return html\n    html = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: destroys the tooltip and removes it from the DOM\n  //\n  // Returns a tip\n  tip.destroy = function() {\n    if(node) {\n      getNodeEl().remove();\n      node = null;\n    }\n    return tip;\n  }\n\n  function d3_tip_direction() { return 'n' }\n  function d3_tip_offset() { return [0, 0] }\n  function d3_tip_html() { return ' ' }\n\n  var direction_callbacks = {\n    n:  direction_n,\n    s:  direction_s,\n    e:  direction_e,\n    w:  direction_w,\n    nw: direction_nw,\n    ne: direction_ne,\n    sw: direction_sw,\n    se: direction_se\n  };\n\n  var directions = Object.keys(direction_callbacks);\n\n  function direction_n() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.n.y - node.offsetHeight,\n      left: bbox.n.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_s() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.s.y,\n      left: bbox.s.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_e() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.e.y - node.offsetHeight / 2,\n      left: bbox.e.x\n    }\n  }\n\n  function direction_w() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.w.y - node.offsetHeight / 2,\n      left: bbox.w.x - node.offsetWidth\n    }\n  }\n\n  function direction_nw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.nw.y - node.offsetHeight,\n      left: bbox.nw.x - node.offsetWidth\n    }\n  }\n\n  function direction_ne() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.ne.y - node.offsetHeight,\n      left: bbox.ne.x\n    }\n  }\n\n  function direction_sw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.sw.y,\n      left: bbox.sw.x - node.offsetWidth\n    }\n  }\n\n  function direction_se() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.se.y,\n      left: bbox.e.x\n    }\n  }\n\n  function initNode() {\n    var node = d3.select(document.createElement('div'))\n    node\n      .style('position', 'absolute')\n      .style('top', 0)\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n      .style('box-sizing', 'border-box')\n      .style('line-heigh', 1.1)\n      .style('padding', '6px')\n      .style('background', \"#000000c0\")\n      .style('color', '#fff')\n      .style('font-size', '14px')\n      .style('font-family', \"'Roboto Condensed', sans-serif\");\n\n    return node.node()\n  }\n\n\n  function getSVGNode(el) {\n    el = el.node()\n    if(el.tagName.toLowerCase() === 'svg')\n      return el\n\n    return el.ownerSVGElement\n  }\n\n  function getNodeEl() {\n    if(node === null) {\n      node = initNode();\n      // re-add node to DOM\n      document.body.appendChild(node);\n    };\n    return d3.select(node);\n  }\n\n  // Returns an Object {n, s, e, w, nw, sw, ne, se}\n  function getScreenBBox() {\n    var targetel   = target || d3.event.target;\n\n    while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {\n        targetel = targetel.parentNode;\n    }\n\n    var bbox       = {},\n        matrix     = targetel.getScreenCTM(),\n        tbbox      = targetel.getBBox(),\n        width      = tbbox.width,\n        height     = tbbox.height,\n        x          = tbbox.x,\n        y          = tbbox.y\n\n    point.x = x\n    point.y = y\n    bbox.nw = point.matrixTransform(matrix)\n    point.x += width\n    bbox.ne = point.matrixTransform(matrix)\n    point.y += height\n    bbox.se = point.matrixTransform(matrix)\n    point.x -= width\n    bbox.sw = point.matrixTransform(matrix)\n    point.y -= height / 2\n    bbox.w  = point.matrixTransform(matrix)\n    point.x += width\n    bbox.e = point.matrixTransform(matrix)\n    point.x -= width / 2\n    point.y -= height / 2\n    bbox.n = point.matrixTransform(matrix)\n    point.y += height\n    bbox.s = point.matrixTransform(matrix)\n\n    return bbox\n  }\n\n  return tip\n};\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/prototype.js */\nvar minValue   = options.xmin,\n    maxValue = options.xmax,\n    n = options.n, m = options.m,\n    barWidth = options.barWidth,\n    chartTitle = options.chartTitle;\n\nvar time = options.time;\n\nvar maxLength = calculateTextWidth(data[1])+15;\n\nvar margin = {top: 98, right: 30, bottom: 71, left: maxLength, inner: 42},\n    w = width - margin.left - margin.right,\n    h = height - margin.top - margin.bottom,\n    plotTop = margin.top,\n    plotHeight = m*barWidth + (m+1)*barWidth/2,\n    plotWidth = 420*1.2;\n\nif (options.scaleHeight === true) {\n  if (h > n*plotHeight + (n-1)*margin.inner) {\n    var temp = h - n*plotHeight - (n-1)*margin.inner;\n    plotTop += temp/2;\n  }\n}\n\nif (options.vcolors === \"default\") {\n  var colors = getColors(n, \"breakDown\"),\n    positiveColor = colors[0],\n    negativeColor = colors[1],\n    defaultColor = colors[2];\n} else {\n  var colors = options.vcolors,\n    positiveColor = colors[0],\n    negativeColor = colors[1],\n    defaultColor = colors[2];\n}\n\n\nbreakDown(data);\n\n// change font\nsvg.selectAll(\"text\")\n  .style('font-family', 'Fira Sans, sans-serif');\n\nfunction breakDown(data){\n  var barData = data[0];\n  var modelNames = Object.keys(barData);\n\n  for (let i=0; i<n; i++){\n      let modelName = modelNames[i];\n      singlePlot(modelName, barData[modelName], i+1);\n  }\n}\n\nfunction singlePlot(modelName, bData, i){\n\n  var x = d3.scaleLinear()\n        .range([margin.left,  margin.left + plotWidth])\n        .domain([minValue, maxValue]);\n\n  if (i == n){\n\n    var xAxis = d3.axisBottom(x)\n                .ticks(5)\n                .tickSize(0);\n\n    xAxis = svg.append(\"g\")\n            .attr(\"class\", \"axisLabel\")\n            .attr(\"transform\", \"translate(0,\" + (plotTop + plotHeight) + \")\")\n            .call(xAxis)\n            .call(g => g.select(\".domain\").remove());\n  }\n\n  var y = d3.scaleBand()\n        .rangeRound([plotTop, plotTop + plotHeight])\n        .padding(0.33)\n        .domain(bData.map(function (d) {\n             return d.variable;\n        }));\n\n  var xGrid = svg.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(0,\" + (plotTop + plotHeight) + \")\")\n         .call(d3.axisBottom(x)\n                .ticks(10)\n                .tickSize(-plotHeight)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  // effort to make grid endings clean\n  let str = xGrid.select('.tick:first-child').attr('transform');\n  let yGridStart = str.substring(str.indexOf(\"(\")+1,str.indexOf(\",\"));\n  str = xGrid.select('.tick:last-child').attr('transform');\n  let yGridEnd = str.substring(str.indexOf(\"(\")+1,str.indexOf(\",\"));\n\n  var yGrid = svg.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(\" + yGridStart + \",0)\")\n         .call(d3.axisLeft(y)\n                .tickSize(-(yGridEnd-yGridStart))\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n        .tickSize(0);\n\n  yAxis = svg.append(\"g\")\n        .attr(\"class\", \"axisLabel\")\n        .attr(\"transform\",\"translate(\" + (yGridStart-10) + \",0)\")\n        .call(yAxis)\n        .call(g => g.select(\".domain\").remove());\n\n  yAxis.select(\".tick:last-child\").select(\"text\").attr('font-weight', 600);\n\n  svg.append(\"text\")\n        .attr(\"x\", yGridStart)\n        .attr(\"y\", plotTop - 15)\n        .attr(\"class\", \"smallTitle\")\n        .text(modelName);\n\n  if (i == 1){\n    svg.append(\"text\")\n          .attr(\"x\", yGridStart)\n          .attr(\"y\", plotTop - 60)\n          .attr(\"class\", \"bigTitle\")\n          .text(chartTitle);\n  }\n\n  // add tooltip\n  var tool_tip = d3.tip()\n        .attr(\"class\", \"tooltip\")\n        .offset([-8, 0])\n        .html(function(d) { return staticTooltipHtml(d); });\n\n  svg.call(tool_tip);\n\n  // find boundaries\n  let intercept = bData[0].contribution > 0 ? bData[0].barStart : bData[0].barSupport;\n\n  // make dotted line from intercept to prediction\n  var dotLineData = [{\"x\": x(intercept), \"y\": y(\"intercept\")},\n                     {\"x\": x(intercept), \"y\": y(\"prediction\") + barWidth}];\n\n  var lineFunction = d3.line()\n                         .x(function(d) { return d.x; })\n                         .y(function(d) { return d.y; });\n  svg.append(\"path\")\n        .data([dotLineData])\n        .attr(\"class\", \"dotLine\")\n        .attr(\"d\", lineFunction)\n        .style(\"stroke-dasharray\", (\"1, 2\"));\n\n  // add bars\n  var bars = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  bars.append(\"rect\")\n        .attr(\"class\", modelName.replace(/\\s/g,''))\n        .attr(\"fill\",function(d){\n          switch(d.sign){\n            case \"-1\":\n              return negativeColor;\n            case \"1\":\n              return positiveColor;\n            default:\n              return defaultColor;\n          }\n        })\n        .attr(\"y\", d => y(d.variable) )\n        .attr(\"height\", y.bandwidth() )\n        .attr(\"x\", d => d.contribution > 0 ? x(d.barStart) : x(d.barSupport))\n        .on('mouseover', tool_tip.show)\n        .on('mouseout', tool_tip.hide)\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return i * time })\n        .attr(\"width\", d => x(d.barSupport) - x(d.barStart))\n        .attr(\"x\", d => x(d.barStart));\n\n  // add labels to bars\n  var contributionLabel = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  contributionLabel.append(\"text\")\n        .attr(\"x\", d => {\n          switch(d.sign){\n            case \"X\":\n              return d.contribution < 0 ? x(d.barStart) - 5 : x(d.barSupport) + 5;\n            default:\n              return x(d.barSupport) + 5;\n          }\n        })\n        .attr(\"text-anchor\", d => d.sign == \"X\" && d.contribution < 0 ? \"end\" : null)\n        .attr(\"y\", d => y(d.variable) + barWidth/2)\n        .attr(\"dy\", \"0.5em\")\n        .attr(\"class\", \"axisLabel\")\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return (i+1) * time })\n        .text(d => {\n          switch(d.variable){\n            case \"intercept\":\n            case \"prediction\":\n              return d.cummulative;\n            default:\n              return d.sign === \"-1\" ? d.contribution : \"+\"+d.contribution;\n          }\n        });\n\n  // add lines to bars\n  var lines = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  lines.append(\"line\")\n        .attr(\"class\", \"interceptLine\")\n        .attr(\"x1\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y1\", d => y(d.variable))\n        .attr(\"x2\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y2\", d => y(d.variable))\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return (i+1) * time })\n        .attr(\"y2\", d => d.variable == \"prediction\" ? y(d.variable) : y(d.variable) + barWidth*2.5);\n\n  // update plotTop\n  plotTop += (margin.inner + plotHeight);\n}\n\nfunction staticTooltipHtml(d, prediction) {\n  var temp = \"<center>\";\n  temp += d.tooltipText;\n  temp += \"<\/center>\";\n  return temp;\n}\n};","style":"/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/themeDrWhy.css */\n@import url('https://fonts.googleapis.com/css?family=Fira+Sans:400,600');\n\ntext {\n    fill: #371ea3;\n}\n\n.bigTitle {\n    font-weight: 600;\n    font-size: 18px;\n    text-align: left;\n}\n\n.smallTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: left;\n}\n\n.axisTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: center;\n}\n\n.axisLabel{\n    font-weight:400;\n    font-size: 11px;\n}\n\n.axisLabel .domain{\n    stroke: #371ea3;\n}\n\n.legendTitle{\n    font-weight: 400;\n    font-size: 13px;\n    text-align: left;\n}\n\n.interceptLine{\n    stroke: #371ea3;\n\tstroke-width: 1px;\n\tstroke-opacity: 1;\n\tstroke-linecap: \"butt\";\n}\n\n.dotLine{\n  \t\tfill: none;\n  \t\tstroke: #371ea3;\n  \t\tstroke-width: 0.7px;\n}\n\n.grid .tick line{\n    stroke: #f0f0f4;\n    stroke-width: 1px\n}\n\n.d3-tip {\n    line-height: 1.1;\n    padding: 6px;\n    background: #00000080;\n    color: #fff;\n    border-radius: 0px;\n    font-size: 14px;\n    font-family: 'Roboto Condensed', sans-serif;\n}\n\n/* Creates a small triangle extender for the tooltip */\n.d3-tip:after {\n    box-sizing: border-box;\n    display: inline;\n    font-size: 10px;\n    width: 100%;\n    line-height: 1;\n    color: rgba(0, 0, 0, 0.8);\n    content: \"\\25BC\";\n    position: absolute;\n    text-align: center;\n}\n\n/* Style northward tooltips specifically */\n.d3-tip.n:after {\n    margin: -2px 0 0 0;\n    top: 100%;\n    left: 0;\n}","version":4,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
<div id="svm" class="section level2">
<h2 class="hasAnchor">
<a href="#svm" class="anchor"></a>SVM</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(e1071)

m_svm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span>(status <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> HR, <span class="dt">type =</span> <span class="st">"C-classification"</span>, <span class="dt">probability =</span> <span class="ot">TRUE</span>)

p_fun &lt;-<span class="st"> </span><span class="cf">function</span>(object, newdata){
  p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(object, <span class="dt">newdata =</span> newdata, <span class="dt">probability =</span> <span class="ot">TRUE</span>)
  <span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(p, <span class="st">"probabilities"</span>)
  }

bd_svm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/local_attributions.html">local_attributions</a></span>(m_svm,
                            <span class="dt">data =</span> HR_test,
                            <span class="dt">new_observation =</span>  new_observation,
                            <span class="dt">predict_function =</span> p_fun)

<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_svm)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div id="knn" class="section level2">
<h2 class="hasAnchor">
<a href="#knn" class="anchor"></a>knn</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"caret"</span>)
m_knn &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/caret/man/knn3.html">knn3</a></span>(status <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> HR, <span class="dt">k =</span> <span class="dv">5</span>)
bd_knn &lt;-<span class="st"> </span><span class="kw"><a href="../reference/local_attributions.html">local_attributions</a></span>(m_knn,
                            <span class="dt">data =</span> HR_test,
                            <span class="dt">new_observation =</span>  new_observation)

<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(bd_knn)</code></pre></div>
<p><img src="vignette_iBreakDown_classification_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plotD3.html">plotD3</a></span>(bd_knn)</code></pre></div>
<div id="htmlwidget-5a365a5af7e09357e303" style="width:576px;height:576px;" class="r2d3 html-widget"></div>
<script type="application/json" data-for="htmlwidget-5a365a5af7e09357e303">{"x":{"data":[{"knn3.fired":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.351,"sign":"X","position":8,"label":"knn3.fired","barStart":0.3507,"barSupport":0.3507,"tooltipText":"Average response: 0.351<br>Prediction: 0.6"},{"variable":"hours = 42","contribution":0.228,"variable_name":"hours","variable_value":"42","cummulative":0.578,"sign":"1","position":7,"label":"knn3.fired","barStart":0.3507,"barSupport":0.5785,"tooltipText":"hours = 42<br>increases average response <br>by 0.228"},{"variable":"evaluation = 2","contribution":0.068,"variable_name":"evaluation","variable_value":"2","cummulative":0.646,"sign":"1","position":6,"label":"knn3.fired","barStart":0.5785,"barSupport":0.6463,"tooltipText":"evaluation = 2<br>increases average response <br>by 0.068"},{"variable":"salary = 2","contribution":-0.162,"variable_name":"salary","variable_value":"2","cummulative":0.484,"sign":"-1","position":5,"label":"knn3.fired","barStart":0.484,"barSupport":0.6463,"tooltipText":"salary = 2<br>decreases average response <br>by 0.162"},{"variable":"age = 58","contribution":-0.083,"variable_name":"age","variable_value":"58","cummulative":0.401,"sign":"-1","position":4,"label":"knn3.fired","barStart":0.4005,"barSupport":0.484,"tooltipText":"age = 58<br>decreases average response <br>by 0.083"},{"variable":"gender = male","contribution":0.199,"variable_name":"gender","variable_value":"male","cummulative":0.6,"sign":"1","position":3,"label":"knn3.fired","barStart":0.4005,"barSupport":0.6,"tooltipText":"gender = male<br>increases average response <br>by 0.199"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0.6,"sign":"0","position":2,"label":"knn3.fired","barStart":0.6,"barSupport":0.6,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":0.249,"variable_name":"prediction","variable_value":"","cummulative":0.6,"sign":"X","position":1,"label":"knn3.fired","barStart":0.3507,"barSupport":0.6,"tooltipText":"Average response: 0.351<br>Prediction: 0.6"}],"knn3.ok":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.291,"sign":"X","position":8,"label":"knn3.ok","barStart":0.2908,"barSupport":0.2908,"tooltipText":"Average response: 0.291<br>Prediction: 0.4"},{"variable":"hours = 42","contribution":-0.031,"variable_name":"hours","variable_value":"42","cummulative":0.26,"sign":"-1","position":7,"label":"knn3.ok","barStart":0.2601,"barSupport":0.2908,"tooltipText":"hours = 42<br>decreases average response <br>by 0.031"},{"variable":"evaluation = 2","contribution":0.085,"variable_name":"evaluation","variable_value":"2","cummulative":0.345,"sign":"1","position":6,"label":"knn3.ok","barStart":0.2601,"barSupport":0.3455,"tooltipText":"evaluation = 2<br>increases average response <br>by 0.085"},{"variable":"salary = 2","contribution":0.165,"variable_name":"salary","variable_value":"2","cummulative":0.51,"sign":"1","position":5,"label":"knn3.ok","barStart":0.3455,"barSupport":0.5105,"tooltipText":"salary = 2<br>increases average response <br>by 0.165"},{"variable":"age = 58","contribution":0.089,"variable_name":"age","variable_value":"58","cummulative":0.599,"sign":"1","position":4,"label":"knn3.ok","barStart":0.5105,"barSupport":0.5995,"tooltipText":"age = 58<br>increases average response <br>by 0.089"},{"variable":"gender = male","contribution":-0.199,"variable_name":"gender","variable_value":"male","cummulative":0.4,"sign":"-1","position":3,"label":"knn3.ok","barStart":0.4,"barSupport":0.5995,"tooltipText":"gender = male<br>decreases average response <br>by 0.199"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0.4,"sign":"0","position":2,"label":"knn3.ok","barStart":0.4,"barSupport":0.4,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":0.109,"variable_name":"prediction","variable_value":"","cummulative":0.4,"sign":"X","position":1,"label":"knn3.ok","barStart":0.2908,"barSupport":0.4,"tooltipText":"Average response: 0.291<br>Prediction: 0.4"}],"knn3.promoted":[{"variable":"intercept","contribution":0,"variable_name":"intercept","variable_value":"1","cummulative":0.359,"sign":"X","position":8,"label":"knn3.promoted","barStart":0.3585,"barSupport":0.3585,"tooltipText":"Average response: 0.359<br>Prediction: 0"},{"variable":"hours = 42","contribution":-0.197,"variable_name":"hours","variable_value":"42","cummulative":0.161,"sign":"-1","position":7,"label":"knn3.promoted","barStart":0.1614,"barSupport":0.3585,"tooltipText":"hours = 42<br>decreases average response <br>by 0.197"},{"variable":"evaluation = 2","contribution":-0.153,"variable_name":"evaluation","variable_value":"2","cummulative":0.008,"sign":"-1","position":6,"label":"knn3.promoted","barStart":0.0082,"barSupport":0.1614,"tooltipText":"evaluation = 2<br>decreases average response <br>by 0.153"},{"variable":"salary = 2","contribution":-0.003,"variable_name":"salary","variable_value":"2","cummulative":0.006,"sign":"-1","position":5,"label":"knn3.promoted","barStart":0.0055,"barSupport":0.0082,"tooltipText":"salary = 2<br>decreases average response <br>by 0.003"},{"variable":"age = 58","contribution":-0.006,"variable_name":"age","variable_value":"58","cummulative":0,"sign":"-1","position":4,"label":"knn3.promoted","barStart":0,"barSupport":0.0055,"tooltipText":"age = 58<br>decreases average response <br>by 0.006"},{"variable":"gender = male","contribution":0,"variable_name":"gender","variable_value":"male","cummulative":0,"sign":"0","position":3,"label":"knn3.promoted","barStart":0,"barSupport":0,"tooltipText":"gender = male<br>decreases average response <br>by 0"},{"variable":"status = fired","contribution":0,"variable_name":"status","variable_value":"fired","cummulative":0,"sign":"0","position":2,"label":"knn3.promoted","barStart":0,"barSupport":0,"tooltipText":"status = fired<br>decreases average response <br>by 0"},{"variable":"prediction","contribution":-0.359,"variable_name":"prediction","variable_value":"","cummulative":0,"sign":"X","position":1,"label":"knn3.promoted","barStart":0,"barSupport":0.3585,"tooltipText":"Average response: 0.359<br>Prediction: 0"}]},["intercept","hours = 42","evaluation = 2","salary = 2","age = 58","gender = male","status = fired","prediction","intercept","hours = 42","evaluation = 2","salary = 2","age = 58","gender = male","status = fired","prediction","intercept","hours = 42","evaluation = 2","salary = 2","age = 58","gender = male","status = fired","prediction"]],"type":"json","container":"svg","options":{"xmin":-0.1292,"xmax":0.7752,"n":3,"m":8,"barWidth":12,"scaleHeight":false,"time":0,"vcolors":"default","chartTitle":"Local attributions"},"script":"var d3Script = function(d3, r2d3, data, svg, width, height, options, theme, console) {\nthis.d3 = d3;\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/colorsDrWhy.js */\nfunction getColors(n, type){\n    var temp = [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n    var ret = [];\n\n    if (type == \"bar\") {\n      switch(n){\n        case 1:\n          return [\"#46bac2\"];\n        case 2:\n          return [\"#46bac2\", \"#4378bf\"];\n        case 3:\n          return [\"#8bdcbe\", \"#4378bf\", \"#46bac2\"];\n        case 4:\n          return [\"#46bac2\", \"#371ea3\", \"#8bdcbe\", \"#4378bf\"];\n        case 5:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ffa58c\"];\n        case 6:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\"];\n        case 7:\n          return temp;\n        default:\n          for (var i = 0; i <= n%7; i++) {\n            ret = ret.concat(temp);\n          }\n          return ret;\n      }\n    } else if (type == \"line\") {\n      switch(n){\n        case 1:\n          return [\"#46bac2\"];\n        case 2:\n          return [\"#8bdcbe\", \"#4378bf\"];\n        case 3:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\"];\n        case 4:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ffa58c\"];\n        case 5:\n          return [\"#8bdcbe\", \"#f05a71\", \"#4378bf\", \"#ae2c87\", \"#ffa58c\"];\n        case 6:\n          return [\"#8bdcbe\", \"#f05a71\", \"#46bac2\", \"#ae2c87\", \"#ffa58c\", \"#4378bf\"];\n        case 7:\n          return temp;\n        default:\n          for (var j = 0; j <= n%7; j++) {\n            ret = ret.concat(temp);\n          }\n          return ret;\n      }\n    } else if (type == \"point\") {\n      switch(n){\n        default:\n          return [\"#371ea3\", \"#46bac2\", \"#ceced9\"];\n      }\n    } else if (type == \"breakDown\") {\n      switch(n){\n        default:\n          return [\"#8bdcbe\", \"#f05a71\", \"#371ea3\"];\n      }\n    }\n}\n\nfunction calculateTextWidth(text) {\n  // calculate max width of 11px text array\n\n  var temp = svg.selectAll()\n                .data(text)\n                .enter();\n\n  var textWidth = [];\n\n  temp.append(\"text\")\n      .attr(\"class\", \"toRemove\")\n      .text(function(d) { return d;})\n      .style(\"font-size\", \"11px\")\n      .style('font-family', 'Fira Sans, sans-serif')\n      .each(function(d,i) {\n          var thisWidth = this.getComputedTextLength();\n          textWidth.push(thisWidth);\n      });\n\n  svg.selectAll('.toRemove').remove();\n  temp.remove();\n\n  var maxLength = d3.max(textWidth);\n\n  return maxLength;\n}\n\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/tooltipD3.js */\n// TOOLTIP\n\n// d3.tip\n// Copyright (c) 2013 Justin Palmer\n// ES6 / D3 v4 Adaption Copyright (c) 2016 Constantin Gavrilete\n// Removal of ES6 for D3 v4 Adaption Copyright (c) 2016 David Gotz\n//\n// Tooltips for d3.js SVG visualizations\n\nd3.functor = function functor(v) {\n  return typeof v === \"function\" ? v : function() {\n    return v;\n  };\n};\n\nd3.tip = function() {\n\n  var direction = d3_tip_direction,\n      offset    = d3_tip_offset,\n      html      = d3_tip_html,\n      node      = initNode(),\n      svg       = null,\n      point     = null,\n      target    = null\n\n  function tip(vis) {\n    svg = getSVGNode(vis)\n    point = svg.createSVGPoint()\n    document.body.appendChild(node)\n  }\n\n  // Public - show the tooltip on the screen\n  //\n  // Returns a tip\n  tip.show = function() {\n    var args = Array.prototype.slice.call(arguments)\n    if(args[args.length - 1] instanceof SVGElement) target = args.pop()\n\n    var content = html.apply(this, args),\n        poffset = offset.apply(this, args),\n        dir     = direction.apply(this, args),\n        nodel   = getNodeEl(),\n        i       = directions.length,\n        coords,\n        scrollTop  = document.documentElement.scrollTop || document.body.scrollTop,\n        scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft\n\n    nodel.html(content)\n      .style('position', 'absolute')\n      .style('opacity', 1)\n      .style('pointer-events', 'all')\n\n    while(i--) nodel.classed(directions[i], false)\n    coords = direction_callbacks[dir].apply(this)\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n\n    var divDim = node.getBoundingClientRect(),\n        svgDim = svg.getBBox();\n\n    if (d3.event.pageY + divDim.height > svgDim.height) {\n      nodel.classed(dir, true).style('top', (d3.event.pageY - divDim.height - 10) + scrollTop  + 'px');\n    } else {\n      nodel.classed(dir, true).style('top', (d3.event.pageY + 10) + scrollTop  + 'px');\n    }\n\n    if (d3.event.pageX + divDim.width/2 > svgDim.width) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width - 10) + scrollLeft + 'px');\n    } else if (d3.event.pageX - divDim.width/2 < 5) {\n      nodel.classed(dir, true).style('left', (d3.event.pageX + divDim.width + 10) + scrollLeft + 'px');\n    } else {\n      nodel.classed(dir, true).style('left', (d3.event.pageX - divDim.width/2) + scrollLeft + 'px');\n    }\n\n    ////////////////////////////////::::::::://///////////////////////////////////////////\n    return tip\n  }\n\n  // Public - hide the tooltip\n  //\n  // Returns a tip\n  tip.hide = function() {\n    var nodel = getNodeEl()\n    nodel\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n    return tip\n  }\n\n  // Public: Proxy attr calls to the d3 tip container.  Sets or gets attribute value.\n  //\n  // n - name of the attribute\n  // v - value of the attribute\n  //\n  // Returns tip or attribute value\n  tip.attr = function(n, v) {\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().attr(n)\n    } else {\n      var args =  Array.prototype.slice.call(arguments)\n      d3.selection.prototype.attr.apply(getNodeEl(), args)\n    }\n\n    return tip\n  }\n\n  // Public: Proxy style calls to the d3 tip container.  Sets or gets a style value.\n  //\n  // n - name of the property\n  // v - value of the property\n  //\n  // Returns tip or style property value\n  tip.style = function(n, v) {\n    // debugger;\n    if (arguments.length < 2 && typeof n === 'string') {\n      return getNodeEl().style(n)\n    } else {\n      var args = Array.prototype.slice.call(arguments);\n      if (args.length === 1) {\n        var styles = args[0];\n        Object.keys(styles).forEach(function(key) {\n          return d3.selection.prototype.style.apply(getNodeEl(), [key, styles[key]]);\n        });\n      }\n    }\n\n    return tip\n  }\n\n  // Public: Set or get the direction of the tooltip\n  //\n  // v - One of n(north), s(south), e(east), or w(west), nw(northwest),\n  //     sw(southwest), ne(northeast) or se(southeast)\n  //\n  // Returns tip or direction\n  tip.direction = function(v) {\n    if (!arguments.length) return direction\n    direction = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: Sets or gets the offset of the tip\n  //\n  // v - Array of [x, y] offset\n  //\n  // Returns offset or\n  tip.offset = function(v) {\n    if (!arguments.length) return offset\n    offset = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: sets or gets the html value of the tooltip\n  //\n  // v - String value of the tip\n  //\n  // Returns html value or tip\n  tip.html = function(v) {\n    if (!arguments.length) return html\n    html = v == null ? v : d3.functor(v)\n\n    return tip\n  }\n\n  // Public: destroys the tooltip and removes it from the DOM\n  //\n  // Returns a tip\n  tip.destroy = function() {\n    if(node) {\n      getNodeEl().remove();\n      node = null;\n    }\n    return tip;\n  }\n\n  function d3_tip_direction() { return 'n' }\n  function d3_tip_offset() { return [0, 0] }\n  function d3_tip_html() { return ' ' }\n\n  var direction_callbacks = {\n    n:  direction_n,\n    s:  direction_s,\n    e:  direction_e,\n    w:  direction_w,\n    nw: direction_nw,\n    ne: direction_ne,\n    sw: direction_sw,\n    se: direction_se\n  };\n\n  var directions = Object.keys(direction_callbacks);\n\n  function direction_n() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.n.y - node.offsetHeight,\n      left: bbox.n.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_s() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.s.y,\n      left: bbox.s.x - node.offsetWidth / 2\n    }\n  }\n\n  function direction_e() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.e.y - node.offsetHeight / 2,\n      left: bbox.e.x\n    }\n  }\n\n  function direction_w() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.w.y - node.offsetHeight / 2,\n      left: bbox.w.x - node.offsetWidth\n    }\n  }\n\n  function direction_nw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.nw.y - node.offsetHeight,\n      left: bbox.nw.x - node.offsetWidth\n    }\n  }\n\n  function direction_ne() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.ne.y - node.offsetHeight,\n      left: bbox.ne.x\n    }\n  }\n\n  function direction_sw() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.sw.y,\n      left: bbox.sw.x - node.offsetWidth\n    }\n  }\n\n  function direction_se() {\n    var bbox = getScreenBBox()\n    return {\n      top:  bbox.se.y,\n      left: bbox.e.x\n    }\n  }\n\n  function initNode() {\n    var node = d3.select(document.createElement('div'))\n    node\n      .style('position', 'absolute')\n      .style('top', 0)\n      .style('opacity', 0)\n      .style('pointer-events', 'none')\n      .style('box-sizing', 'border-box')\n      .style('line-heigh', 1.1)\n      .style('padding', '6px')\n      .style('background', \"#000000c0\")\n      .style('color', '#fff')\n      .style('font-size', '14px')\n      .style('font-family', \"'Roboto Condensed', sans-serif\");\n\n    return node.node()\n  }\n\n\n  function getSVGNode(el) {\n    el = el.node()\n    if(el.tagName.toLowerCase() === 'svg')\n      return el\n\n    return el.ownerSVGElement\n  }\n\n  function getNodeEl() {\n    if(node === null) {\n      node = initNode();\n      // re-add node to DOM\n      document.body.appendChild(node);\n    };\n    return d3.select(node);\n  }\n\n  // Returns an Object {n, s, e, w, nw, sw, ne, se}\n  function getScreenBBox() {\n    var targetel   = target || d3.event.target;\n\n    while ('undefined' === typeof targetel.getScreenCTM && 'undefined' === targetel.parentNode) {\n        targetel = targetel.parentNode;\n    }\n\n    var bbox       = {},\n        matrix     = targetel.getScreenCTM(),\n        tbbox      = targetel.getBBox(),\n        width      = tbbox.width,\n        height     = tbbox.height,\n        x          = tbbox.x,\n        y          = tbbox.y\n\n    point.x = x\n    point.y = y\n    bbox.nw = point.matrixTransform(matrix)\n    point.x += width\n    bbox.ne = point.matrixTransform(matrix)\n    point.y += height\n    bbox.se = point.matrixTransform(matrix)\n    point.x -= width\n    bbox.sw = point.matrixTransform(matrix)\n    point.y -= height / 2\n    bbox.w  = point.matrixTransform(matrix)\n    point.x += width\n    bbox.e = point.matrixTransform(matrix)\n    point.x -= width / 2\n    point.y -= height / 2\n    bbox.n = point.matrixTransform(matrix)\n    point.y += height\n    bbox.s = point.matrixTransform(matrix)\n\n    return bbox\n  }\n\n  return tip\n};\nsvg = d3.select(svg.node());\n/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/prototype.js */\nvar minValue   = options.xmin,\n    maxValue = options.xmax,\n    n = options.n, m = options.m,\n    barWidth = options.barWidth,\n    chartTitle = options.chartTitle;\n\nvar time = options.time;\n\nvar maxLength = calculateTextWidth(data[1])+15;\n\nvar margin = {top: 98, right: 30, bottom: 71, left: maxLength, inner: 42},\n    w = width - margin.left - margin.right,\n    h = height - margin.top - margin.bottom,\n    plotTop = margin.top,\n    plotHeight = m*barWidth + (m+1)*barWidth/2,\n    plotWidth = 420*1.2;\n\nif (options.scaleHeight === true) {\n  if (h > n*plotHeight + (n-1)*margin.inner) {\n    var temp = h - n*plotHeight - (n-1)*margin.inner;\n    plotTop += temp/2;\n  }\n}\n\nif (options.vcolors === \"default\") {\n  var colors = getColors(n, \"breakDown\"),\n    positiveColor = colors[0],\n    negativeColor = colors[1],\n    defaultColor = colors[2];\n} else {\n  var colors = options.vcolors,\n    positiveColor = colors[0],\n    negativeColor = colors[1],\n    defaultColor = colors[2];\n}\n\n\nbreakDown(data);\n\n// change font\nsvg.selectAll(\"text\")\n  .style('font-family', 'Fira Sans, sans-serif');\n\nfunction breakDown(data){\n  var barData = data[0];\n  var modelNames = Object.keys(barData);\n\n  for (let i=0; i<n; i++){\n      let modelName = modelNames[i];\n      singlePlot(modelName, barData[modelName], i+1);\n  }\n}\n\nfunction singlePlot(modelName, bData, i){\n\n  var x = d3.scaleLinear()\n        .range([margin.left,  margin.left + plotWidth])\n        .domain([minValue, maxValue]);\n\n  if (i == n){\n\n    var xAxis = d3.axisBottom(x)\n                .ticks(5)\n                .tickSize(0);\n\n    xAxis = svg.append(\"g\")\n            .attr(\"class\", \"axisLabel\")\n            .attr(\"transform\", \"translate(0,\" + (plotTop + plotHeight) + \")\")\n            .call(xAxis)\n            .call(g => g.select(\".domain\").remove());\n  }\n\n  var y = d3.scaleBand()\n        .rangeRound([plotTop, plotTop + plotHeight])\n        .padding(0.33)\n        .domain(bData.map(function (d) {\n             return d.variable;\n        }));\n\n  var xGrid = svg.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(0,\" + (plotTop + plotHeight) + \")\")\n         .call(d3.axisBottom(x)\n                .ticks(10)\n                .tickSize(-plotHeight)\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  // effort to make grid endings clean\n  let str = xGrid.select('.tick:first-child').attr('transform');\n  let yGridStart = str.substring(str.indexOf(\"(\")+1,str.indexOf(\",\"));\n  str = xGrid.select('.tick:last-child').attr('transform');\n  let yGridEnd = str.substring(str.indexOf(\"(\")+1,str.indexOf(\",\"));\n\n  var yGrid = svg.append(\"g\")\n         .attr(\"class\", \"grid\")\n         .attr(\"transform\", \"translate(\" + yGridStart + \",0)\")\n         .call(d3.axisLeft(y)\n                .tickSize(-(yGridEnd-yGridStart))\n                .tickFormat(\"\")\n        ).call(g => g.select(\".domain\").remove());\n\n  var yAxis = d3.axisLeft(y)\n        .tickSize(0);\n\n  yAxis = svg.append(\"g\")\n        .attr(\"class\", \"axisLabel\")\n        .attr(\"transform\",\"translate(\" + (yGridStart-10) + \",0)\")\n        .call(yAxis)\n        .call(g => g.select(\".domain\").remove());\n\n  yAxis.select(\".tick:last-child\").select(\"text\").attr('font-weight', 600);\n\n  svg.append(\"text\")\n        .attr(\"x\", yGridStart)\n        .attr(\"y\", plotTop - 15)\n        .attr(\"class\", \"smallTitle\")\n        .text(modelName);\n\n  if (i == 1){\n    svg.append(\"text\")\n          .attr(\"x\", yGridStart)\n          .attr(\"y\", plotTop - 60)\n          .attr(\"class\", \"bigTitle\")\n          .text(chartTitle);\n  }\n\n  // add tooltip\n  var tool_tip = d3.tip()\n        .attr(\"class\", \"tooltip\")\n        .offset([-8, 0])\n        .html(function(d) { return staticTooltipHtml(d); });\n\n  svg.call(tool_tip);\n\n  // find boundaries\n  let intercept = bData[0].contribution > 0 ? bData[0].barStart : bData[0].barSupport;\n\n  // make dotted line from intercept to prediction\n  var dotLineData = [{\"x\": x(intercept), \"y\": y(\"intercept\")},\n                     {\"x\": x(intercept), \"y\": y(\"prediction\") + barWidth}];\n\n  var lineFunction = d3.line()\n                         .x(function(d) { return d.x; })\n                         .y(function(d) { return d.y; });\n  svg.append(\"path\")\n        .data([dotLineData])\n        .attr(\"class\", \"dotLine\")\n        .attr(\"d\", lineFunction)\n        .style(\"stroke-dasharray\", (\"1, 2\"));\n\n  // add bars\n  var bars = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  bars.append(\"rect\")\n        .attr(\"class\", modelName.replace(/\\s/g,''))\n        .attr(\"fill\",function(d){\n          switch(d.sign){\n            case \"-1\":\n              return negativeColor;\n            case \"1\":\n              return positiveColor;\n            default:\n              return defaultColor;\n          }\n        })\n        .attr(\"y\", d => y(d.variable) )\n        .attr(\"height\", y.bandwidth() )\n        .attr(\"x\", d => d.contribution > 0 ? x(d.barStart) : x(d.barSupport))\n        .on('mouseover', tool_tip.show)\n        .on('mouseout', tool_tip.hide)\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return i * time })\n        .attr(\"width\", d => x(d.barSupport) - x(d.barStart))\n        .attr(\"x\", d => x(d.barStart));\n\n  // add labels to bars\n  var contributionLabel = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  contributionLabel.append(\"text\")\n        .attr(\"x\", d => {\n          switch(d.sign){\n            case \"X\":\n              return d.contribution < 0 ? x(d.barStart) - 5 : x(d.barSupport) + 5;\n            default:\n              return x(d.barSupport) + 5;\n          }\n        })\n        .attr(\"text-anchor\", d => d.sign == \"X\" && d.contribution < 0 ? \"end\" : null)\n        .attr(\"y\", d => y(d.variable) + barWidth/2)\n        .attr(\"dy\", \"0.5em\")\n        .attr(\"class\", \"axisLabel\")\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return (i+1) * time })\n        .text(d => {\n          switch(d.variable){\n            case \"intercept\":\n            case \"prediction\":\n              return d.cummulative;\n            default:\n              return d.sign === \"-1\" ? d.contribution : \"+\"+d.contribution;\n          }\n        });\n\n  // add lines to bars\n  var lines = svg.selectAll()\n        .data(bData)\n        .enter()\n        .append(\"g\");\n\n  lines.append(\"line\")\n        .attr(\"class\", \"interceptLine\")\n        .attr(\"x1\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y1\", d => y(d.variable))\n        .attr(\"x2\", d => d.contribution < 0 ? x(d.barStart) : x(d.barSupport))\n        .attr(\"y2\", d => y(d.variable))\n        .transition()\n        .duration(time)\n        .delay(function(d,i) { return (i+1) * time })\n        .attr(\"y2\", d => d.variable == \"prediction\" ? y(d.variable) : y(d.variable) + barWidth*2.5);\n\n  // update plotTop\n  plotTop += (margin.inner + plotHeight);\n}\n\nfunction staticTooltipHtml(d, prediction) {\n  var temp = \"<center>\";\n  temp += d.tooltipText;\n  temp += \"<\/center>\";\n  return temp;\n}\n};","style":"/* R2D3 Source File:  /home/p.biecek/R/x86_64-pc-linux-gnu-library/3.6/iBreakDown/d3js/themeDrWhy.css */\n@import url('https://fonts.googleapis.com/css?family=Fira+Sans:400,600');\n\ntext {\n    fill: #371ea3;\n}\n\n.bigTitle {\n    font-weight: 600;\n    font-size: 18px;\n    text-align: left;\n}\n\n.smallTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: left;\n}\n\n.axisTitle{\n    font-weight: 600;\n    font-size: 13px;\n    text-align: center;\n}\n\n.axisLabel{\n    font-weight:400;\n    font-size: 11px;\n}\n\n.axisLabel .domain{\n    stroke: #371ea3;\n}\n\n.legendTitle{\n    font-weight: 400;\n    font-size: 13px;\n    text-align: left;\n}\n\n.interceptLine{\n    stroke: #371ea3;\n\tstroke-width: 1px;\n\tstroke-opacity: 1;\n\tstroke-linecap: \"butt\";\n}\n\n.dotLine{\n  \t\tfill: none;\n  \t\tstroke: #371ea3;\n  \t\tstroke-width: 0.7px;\n}\n\n.grid .tick line{\n    stroke: #f0f0f4;\n    stroke-width: 1px\n}\n\n.d3-tip {\n    line-height: 1.1;\n    padding: 6px;\n    background: #00000080;\n    color: #fff;\n    border-radius: 0px;\n    font-size: 14px;\n    font-family: 'Roboto Condensed', sans-serif;\n}\n\n/* Creates a small triangle extender for the tooltip */\n.d3-tip:after {\n    box-sizing: border-box;\n    display: inline;\n    font-size: 10px;\n    width: 100%;\n    line-height: 1;\n    color: rgba(0, 0, 0, 0.8);\n    content: \"\\25BC\";\n    position: absolute;\n    text-align: center;\n}\n\n/* Style northward tooltips specifically */\n.d3-tip.n:after {\n    margin: -2px 0 0 0;\n    top: 100%;\n    left: 0;\n}","version":4,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#glm">glm</a></li>
      <li><a href="#randomforest">randomForest</a></li>
      <li><a href="#svm">SVM</a></li>
      <li><a href="#knn">knn</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Przemyslaw Biecek, Alicja Gosiewska, Hubert Baniecki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
